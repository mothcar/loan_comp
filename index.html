<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>대출 비교</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.20.6/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    const calculateExpenses = (principal, monthlyInterestRate, months, feePercentage) => {
      const interest = principal * (monthlyInterestRate / 100) * months;
      const fee = principal * (feePercentage / 100);
      return { interest, fee, total: interest + fee };
    };

    const formatNumberWithCommas = (num) => {
      return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
    };

    const parseNumberWithCommas = (str) => {
      return parseFloat(str.replace(/,/g, '')) || 0;
    };

    const LoanComparison = () => {
      const [condition1, setCondition1] = useState({
        principal: 15000000000,
        principalDisplay: '15,000,000,000',
        monthlyInterestRate: 1.5,
        months: 3,
        feePercentage: 5,
      });

      const [condition2, setCondition2] = useState({
        principal: 15000000000,
        principalDisplay: '15,000,000,000',
        monthlyInterestRate: 0.8,
        months: 3,
        feePercentage: 10,
      });

      const chartRef = useRef(null);
      const chartInstanceRef = useRef(null);

      const updateChart = () => {
        const expenses1 = calculateExpenses(
          condition1.principal,
          condition1.monthlyInterestRate,
          condition1.months,
          condition1.feePercentage
        );
        const expenses2 = calculateExpenses(
          condition2.principal,
          condition2.monthlyInterestRate,
          condition2.months,
          condition2.feePercentage
        );

        const data = {
          labels: ['조건 1', '조건 2'],
          datasets: [
            {
              label: '이자 (KRW)',
              data: [expenses1.interest, expenses2.interest],
              backgroundColor: 'rgba(75, 192, 192, 0.6)',
              borderColor: 'rgba(75, 192, 192, 1)',
              borderWidth: 1,
            },
            {
              label: '수수료 (KRW)',
              data: [expenses1.fee, expenses2.fee],
              backgroundColor: 'rgba(255, 99, 132, 0.6)',
              borderColor: 'rgba(255, 99, 132, 1)',
              borderWidth: 1,
            },
          ],
        };

        if (chartInstanceRef.current) {
          chartInstanceRef.current.destroy();
        }

        const ctx = chartRef.current.getContext('2d');
        chartInstanceRef.current = new Chart(ctx, {
          type: 'bar',
          data: data,
          options: {
            responsive: true,
            scales: {
              x: {
                stacked: true,
                title: {
                  display: true,
                  text: '조건',
                },
              },
              y: {
                stacked: true,
                beginAtZero: true,
                title: {
                  display: true,
                  text: '비용 (KRW)',
                },
                ticks: {
                  callback: function(value) {
                    return '₩' + value.toLocaleString('ko-KR');
                  },
                },
              },
            },
            plugins: {
              legend: {
                display: true,
              },
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return `${context.dataset.label}: ₩${context.parsed.y.toLocaleString('ko-KR')}`;
                  },
                },
              },
            },
          },
        });
      };

      useEffect(() => {
        updateChart();
        return () => {
          if (chartInstanceRef.current) {
            chartInstanceRef.current.destroy();
          }
        };
      }, [condition1, condition2]);

      const handleInputChange = (condition, setCondition) => (e) => {
        const { name, value } = e.target;
        if (name === 'principal') {
          const rawValue = parseNumberWithCommas(value);
          setCondition(prev => ({
            ...prev,
            principal: rawValue,
            principalDisplay: formatNumberWithCommas(value.replace(/,/g, '')),
          }));
        } else {
          setCondition(prev => ({
            ...prev,
            [name]: name === 'feePercentage' ? parseInt(value) || 0 : parseFloat(value) || 0,
          }));
        }
      };

      const formatNumber = (num) => {
        return num.toLocaleString('ko-KR');
      };

      const calculateDifference = () => {
        const total1 = calculateExpenses(
          condition1.principal,
          condition1.monthlyInterestRate,
          condition1.months,
          condition1.feePercentage
        ).total;
        const total2 = calculateExpenses(
          condition2.principal,
          condition2.monthlyInterestRate,
          condition2.months,
          condition2.feePercentage
        ).total;
        return Math.abs(total1 - total2);
      };

      return (
        <div className="container mx-auto p-4">
          <h1 className="text-2xl font-bold mb-4 text-center">대출 조건 비교</h1>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div className="p-4 border rounded shadow">
              <h2 className="text-xl font-semibold mb-2">조건 1</h2>
              <div className="mb-2">
                <label className="block">대출 금액 (KRW):</label>
                <input
                  type="text"
                  name="principal"
                  value={condition1.principalDisplay}
                  onChange={handleInputChange(condition1, setCondition1)}
                  className="w-full p-2 border rounded"
                  placeholder="예: 15,000,000,000"
                />
              </div>
              <div className="mb-2">
                <label className="block">월 이자율 (%):</label>
                <input
                  type="number"
                  name="monthlyInterestRate"
                  value={condition1.monthlyInterestRate}
                  onChange={handleInputChange(condition1, setCondition1)}
                  step="0.1"
                  className="w-full p-2 border rounded"
                />
              </div>
              <div className="mb-2">
                <label className="block">대출 기간 (개월):</label>
                <input
                  type="number"
                  name="months"
                  value={condition1.months}
                  onChange={handleInputChange(condition1, setCondition1)}
                  className="w-full p-2 border rounded"
                />
              </div>
              <div className="mb-2">
                <label className="block">수수료율 (%):</label>
                <input
                  type="number"
                  name="feePercentage"
                  value={condition1.feePercentage}
                  onChange={handleInputChange(condition1, setCondition1)}
                  step="1"
                  className="w-full p-2 border rounded"
                />
              </div>
              <p className="mt-2">
                총 비용 (이자 + 수수료): ₩{formatNumber(calculateExpenses(
                  condition1.principal,
                  condition1.monthlyInterestRate,
                  condition1.months,
                  condition1.feePercentage
                ).total)}
              </p>
            </div>
            <div className="p-4 border rounded shadow">
              <h2 className="text-xl font-semibold mb-2">조건 2</h2>
              <div className="mb-2">
                <label className="block">대출 금액 (KRW):</label>
                <input
                  type="text"
                  name="principal"
                  value={condition2.principalDisplay}
                  onChange={handleInputChange(condition2, setCondition2)}
                  className="w-full p-2 border rounded"
                  placeholder="예: 15,000,000,000"
                />
              </div>
              <div className="mb-2">
                <label className="block">월 이자율 (%):</label>
                <input
                  type="number"
                  name="monthlyInterestRate"
                  value={condition2.monthlyInterestRate}
                  onChange={handleInputChange(condition2, setCondition2)}
                  step="0.1"
                  className="w-full p-2 border rounded"
                />
              </div>
              <div className="mb-2">
                <label className="block">대출 기간 (개월):</label>
                <input
                  type="number"
                  name="months"
                  value={condition2.months}
                  onChange={handleInputChange(condition2, setCondition2)}
                  className="w-full p-2 border rounded"
                />
              </div>
              <div className="mb-2">
                <label className="block">수수료율 (%):</label>
                <input
                  type="number"
                  name="feePercentage"
                  value={condition2.feePercentage}
                  onChange={handleInputChange(condition2, setCondition2)}
                  step="1"
                  className="w-full p-2 border rounded"
                />
              </div>
              <p className="mt-2">
                총 비용 (이자 + 수수료): ₩{formatNumber(calculateExpenses(
                  condition2.principal,
                  condition2.monthlyInterestRate,
                  condition2.months,
                  condition2.feePercentage
                ).total)}
              </p>
            </div>
          </div>
          <div className="mt-8">
            <div className="flex items-center justify-center mb-2">
              <h2 className="text-xl font-semibold mr-4">총 비용 비교</h2>
              <p className="text-lg">
                차액: ₩{formatNumber(calculateDifference())}
              </p>
            </div>
            <canvas id="expenseChart" ref={chartRef} className="w-full h-64"></canvas>
          </div>
        </div>
      );
    };

    ReactDOM.render(<LoanComparison />, document.getElementById('root'));
  </script>
</body>
</html>